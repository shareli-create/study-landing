<!DOCTYPE html>
<html>
<head>
    <title>Study Loading</title>
</head>
<body>
    <h2>Research Study</h2>
    <div id="status">Checking availability...</div>
    
    <script>
    fetch('https://script.google.com/macros/s/AKfycbwsMUGoRs7t02_CQnHsAprMjLPEPONSJQIEyQbDm247ypdcCtUTQ6RHRaPdVDozcwiN/exec')
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                document.getElementById('status').innerHTML = 'Error: ' + data.error;
            } else if (data.status === 'full') {
                document.getElementById('status').innerHTML = 'We are sorry but the study reached its participants limit';
            } else {
                document.getElementById('status').innerHTML = 'Redirecting to condition ' + data.condition + '...';
                const condition = data.condition;
                const subjectId = condition + (Math.floor(Math.random() * 1000) * 12);
                setTimeout(() => {
                    window.location.href = 'https://mili2nd.co/nujc?subjectid=' + subjectId;
                }, 3000);
            }
        })
        .catch(error => {
            document.getElementById('status').innerHTML = 'Connection error: ' + error;
        });
    </script>
</body>
</html>
