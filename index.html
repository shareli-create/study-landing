<!DOCTYPE html>
<html>
<head>
    <title>Study Loading</title>
</head>
<body>
    <h2>Research Study</h2>
    <div id="status">Checking availability...</div>
    <div id="debug"></div>
    
    <script>
    fetch('https://script.google.com/macros/s/AKfycbwsMUGoRs7t02_CQnHsAprMjLPEPONSJQIEyQbDm247ypdcCtUTQ6RHRaPdVDozcwiN/exec')
        .then(response => response.json())
        .then(data => {
            // Show what we received
            document.getElementById('debug').innerHTML = 'Received data: ' + JSON.stringify(data);
            
            if (data.error) {
                document.getElementById('status').innerHTML = 'Error: ' + data.error;
            } else if (data.status === 'full') {
                document.getElementById('status').innerHTML = 'We are sorry but the study reached its participants limit';
            } else {
                const condition = data.condition;
                document.getElementById('debug').innerHTML += '<br>Condition: ' + condition;
                
                const subjectId = condition + (Math.floor(Math.random() * 1000) * 12);
                document.getElementById('debug').innerHTML += '<br>Subject ID: ' + subjectId;
                
                const finalURL = 'https://mili2nd.co/nujc?subjectid=' + subjectId;
                document.getElementById('debug').innerHTML += '<br>Final URL: ' + finalURL;
                
                document.getElementById('status').innerHTML = 'Redirecting to condition ' + condition + '...';
                
                setTimeout(() => {
                    window.location.href = finalURL;
                }, 5000); // 5 seconds to see debug info
            }
        })
        .catch(error => {
            document.getElementById('status').innerHTML = 'Connection error: ' + error;
        });
    </script>
</body>
</html>
