<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyfRRNc7DHnWofIE-2_nAoP4iUsfEMQWIlaooOy6g7V5J88uH_-hPGDlyTE3GQdDvxh/exec';

function checkStudyAvailability() {
    fetch(SCRIPT_URL)
        .then(response => response.json())
        .then(data => {
            if (data.status === 'full') {
                document.getElementById('status').innerHTML = 'Study Complete - Code: FULL123';
            } else {
                const condition = data.condition;
                const baseNumber = Math.floor(Math.random() * 10000);
                let subjectId = (condition === 6) ? baseNumber * 6 : (baseNumber * 6) + condition;
                
                setTimeout(() => {
                    window.location.href = `https://mili2nd.co/54ic?subjectid=${subjectId}`;
                }, 2000);
            }
        })
        .catch(error => {
            document.getElementById('status').innerHTML = 'Error loading study. Please refresh the page.';
        });
}

window.addEventListener('load', function() {
    setTimeout(checkStudyAvailability, 1000);
});
</script>
